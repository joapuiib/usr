#!/bin/bash

# Declara una variable d'entorn i un alias per anar a la ruta
# $1 id alias/variable
# $2 ruta
set_variable_alias () {
    # -g declares a global variable
    declare -g -x "$1"="$2"
    alias "$1"="cd $2"
}

dovers="$HOME/docencia/python/dovers"

if [ -d "$HOME/docencia/middleman/itb/" ] ; then
    set_variable_alias "itb" "$HOME/docencia/middleman/itb/"
elif [ -d "$HOME/itb/" ] ; then
    set_variable_alias "itb" "$HOME/itb/"
else
    return
fi

alias itbrun="cd $itb; ./run.sh"
set_variable_alias "itb_data" "$itb/data"
set_variable_alias "itb_source" "$itb/source"
set_variable_alias "itb_templates" "$itb/templates"

declare -A moduls
moduls=()
moduls+=(["m1"]="DAM-M01")
moduls+=(["m3"]="DAM-M03")
moduls+=(["m16"]="DAM-M16")
moduls+=(["llmq"]="ASIX-LLMQ")
moduls+=(["bbdd"]="DAW-BBDD")
moduls+=(["dbms"]="ASIX-SGBD")
moduls+=(["batx"]="BATX-TIC1")
moduls+=(["cefire"]="CEFIRE")

for modul in ${!moduls[@]}; do
    codi=${moduls[$modul]}
    set_variable_alias "${modul}" "$itb_source/$codi"
    if [ -d "$itb_source/$codi/files" ]; then
        set_variable_alias "${modul}f" "$itb_source/$codi/files"
    fi
    set_variable_alias "${modul}_data" "$itb_data/moduls/$codi"
    if [ -d $itb_source/$codi ]; then
        UFS=`find "$itb_source/$codi" -maxdepth 1 -name UF\* | sed 's/^.*UF//'`
        for i in $UFS; do
            set_variable_alias "${modul}$i" "$itb_source/$codi/UF$i"
            if [ -d "$itb_source/$codi/UF$i/files" ]; then
                set_variable_alias "${modul}${i}f" "$itb_source/$codi/UF${i}/files"
            fi
        done
    fi
done
unset codi

GREEN='\033[0;32m'
RED='\033[0;31m'
RESET='\033[0m'

alias todo="vi $HOME/docencia/TODO.txt"
_push_todo(){
    echo -e "${GREEN}git -C $HOME/docencia pull${RESET}"
    git -C $HOME/docencia pull
    echo -e "${GREEN}git -C $HOME/docencia add TODO.txt${RESET}"
    git -C $HOME/docencia add TODO.txt
    echo -e "${GREEN}git -C $HOME/docencia commit -m "Update TODO"${RESET}"
    git -C $HOME/docencia commit -m "Update TODO"
    echo -e "${GREEN}git -C $HOME/docencia push${RESET}"
    git -C $HOME/docencia push
}
alias todo_push=_push_todo
